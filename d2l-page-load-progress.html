<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../d2l-colors/d2l-colors.html">
<dom-module id="d2l-page-load-progress">
	<style include="d2l-colors">
		:host {
			background-color: var(--d2l-color-woolonardo);
			display: block;
			overflow: hidden;
		}
		.d2l-page-load-progress-bar {
			background-color: var(--d2l-color-pressicus);
			transition: background-color 300ms;
			transform: translate(-100%,0);
		}
		:host, .d2l-page-load-progress-bar {
			height: 4px;
		}
		.d2l-page-load-progress-fast, .d2l-page-load-progress-slow {
			will-change: transform;
		}
		.d2l-page-load-progress-fast {
			transition: transform 300ms ease-in;
		}
		.d2l-page-load-progress-slow {
			transition: transform 10s cubic-bezier(.16,1,.4,1);
		}
	</style>
	<template>
		<div><div class="d2l-page-load-progress-bar"></div></div>
	</template>
</dom-module>
<script>
	Polymer({
		is: 'd2l-page-load-progress',

		properties: {
			autostart: {
				type: Boolean,
				reflectToAttribute: true
			},
			color: {
				type: String,
				observer: '_colorChanged',
				reflectToAttribute: true
			},
			width: {
				type: Number,
				readOnly: true,
				value: 0
			}
		},

		attached: function() {
			if (this.autostart) {
				this.start();
			}
		},

		finish: function() {
			this._toggle(false, true, 100);
		},

		start: function() {
			this._toggle(false, false, 0);
			this.async(function() {
				if (this.width === 0) {
					this._toggle(true, false, 99);
				}
			}.bind(this), 100);
		},

		_colorChanged: function(newValue) {
			this.$$('.d2l-page-load-progress-bar').style.backgroundColor = newValue;
		},

		_toggle: function(slow, fast, width) {
			var div = this.$$('.d2l-page-load-progress-bar');
			this.toggleClass(
				'd2l-page-load-progress-slow',
				slow,
				div
			);
			this.toggleClass(
				'd2l-page-load-progress-fast',
				fast,
				div
			);
			this._setWidth(width);
			div.style.transform = 'translate(-' + (100 - width) + '%,0)';
		}

	});
</script>
