<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../vui-colors/colors.html">
<dom-module id="d2l-page-load-progress">
	<style include="vui-colors">
		:host {
			background-color: var(--vui-color-woolonardo);
			display: block;
		}
		.d2l-page-load-progress-bar {
			background-color: var(--vui-color-pressicus);
			transition: background-color 300ms;
			width: 0;
		}
		:host, .d2l-page-load-progress-bar {
			height: 4px;
		}
		.d2l-page-load-progress-fast {
			transition: width 300ms ease-in;
		}
		.d2l-page-load-progress-slow {
			transition: width 10s cubic-bezier(.16,1,.4,1);
		}
	</style>
	<template>
		<div class="d2l-page-load-progress-bar"></div>
	</template>
</dom-module>
<script>
	Polymer({
		is: 'd2l-page-load-progress',
		properties: {
			autostart: {
				type: Boolean,
				reflectToAttribute: true
			},
			color: {
				type: String,
				observer: '_colorChanged',
				reflectToAttribute: true,
				value: '#b9c2d0'
			}
		},
		_colorChanged: function(newValue) {
			this.$$('div').style.backgroundColor = newValue;
		},
		_toggle: function(slow, fast, width) {
			var div = this.$$('div');
			this.toggleClass(
					'd2l-page-load-progress-slow',
					slow,
					div
				);
			this.toggleClass(
					'd2l-page-load-progress-fast',
					fast,
					div
				);
			this.async(function() {
				div.style.width = width;
			}, 0);
		},
		ready: function() {
			if (this.autostart) {
				this.start();
			}
		},
		finish: function() {
			this._toggle(false, true, '100%');
		},
		start: function() {
			this._toggle(false, false, '0%');
			this.async(function() {
				this._toggle(true, false, '99%');
			}.bind(this), 100);
		}
	});
</script>
